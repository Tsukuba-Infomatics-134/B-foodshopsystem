<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>食糧販売 予約管理システム プロトタイプ Ver.4</title>
    <style>
        /* --- 基本スタイル --- */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
            background-color: #f4f5f7; 
            margin: 0; 
            padding: 20px; 
            color: #172b4d; 
            overflow-x: auto; /* 画面幅が足りない場合に横スクロールを許可 */
        }
        h1 { 
            text-align: center; 
            margin-bottom: 20px; 
        }
        
        /* --- メインコンテンツエリア --- */
        .main-container { 
            display: flex; 
            gap: 20px; 
            align-items: flex-start; 
            justify-content: center; 
            flex-wrap: nowrap; /* 常に横並びを維持 */
            min-width: fit-content; /* コンテンツの幅に合わせて最小幅を確保 */
        }
        .board { 
            display: flex; 
            gap: 15px; 
            flex-wrap: nowrap; /* 常に横並びを維持 */
            flex-shrink: 0; /* 縮小させない */
        }

        /* --- 各列（ステータス）のスタイル --- */
        .column { 
            background-color: #ebecf0; 
            border-radius: 8px; 
            width: 200px; /* 幅を固定 */
            padding: 10px; 
            flex-shrink: 0; 
            transition: background-color 0.2s ease; 
        }
        .column h2 { 
            font-size: 16px; 
            padding: 0 8px; 
            margin: 10px 0; 
        }
        .card-container { 
            min-height: 100px; 
            padding-bottom: 10px; 
        }
        
        /* --- 禁止されたドロップ先を示すスタイル --- */
        .column.drop-forbidden {
            background-color: #ffcdd2; /* 薄い赤色 */
            border: 1px dashed #c62828;
        }

        /* --- 予約カードのスタイル --- */
        .card { 
            background-color: #ffffff; 
            border-radius: 5px; 
            padding: 15px; 
            margin-bottom: 10px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); 
            cursor: grab; 
        }
        .card:hover { 
            box-shadow: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23); 
        }
        .card .card-id { 
            font-weight: bold; 
            font-size: 14px; 
            margin-bottom: 5px; 
        }
        .card .card-custom-status { 
            display: none; 
            padding: 2px 8px; 
            font-size: 12px; 
            font-weight: bold; 
            background-color: #6c757d; 
            color: white; 
            border-radius: 10px; 
            margin-bottom: 8px; 
            display: inline-block; 
        }
        .card .card-content { 
            font-size: 14px; 
            line-height: 1.4; 
            margin-top: 5px; 
        }
        .card.dragging { 
            opacity: 0.5; 
            transform: rotate(3deg); 
            cursor: grabbing; 
        }

        /* --- 履歴ログのスタイル --- */
        .history-log { 
            width: 350px; /* 幅を固定 */
            background-color: #ffffff; 
            border-radius: 8px; 
            padding: 10px 20px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); 
            flex-shrink: 0; 
        }
        .history-log h2 { 
            font-size: 16px; 
            border-bottom: 1px solid #ebecf0; 
            padding-bottom: 10px; 
        }
        .history-log ul { 
            list-style: none; 
            padding: 0; 
            margin: 0; 
            height: 400px; 
            overflow-y: auto; 
        }
        .history-log li { 
            font-size: 13px; 
            padding: 10px 5px; 
            border-bottom: 1px solid #f4f5f7; 
        }
        .history-log li.highlight { 
            background-color: #e6f7ff; 
        }
        .log-time { 
            color: #5e6c84; 
            display: block; 
            font-size: 12px; 
            margin-bottom: 4px; 
        }
        .log-id { 
            font-weight: bold; 
            color: #0052cc; 
        }
    </style>
</head>
<body>

    <h1>食糧販売 予約管理システム</h1>

    <div class="main-container">
        <div class="board">
            <div id="calling-column" class="column" data-status-name="呼び出し中">
                <h2>📞 呼び出し中</h2>
                <div class="card-container">
                    <div class="card" draggable="true"><div class="card-id">ID: #00125</div><div class="card-custom-status" style="display: none;"></div><div class="card-content">・ハンバーグ弁当 x 1<br>・コールスロー x 1</div></div>
                </div>
            </div>

            <div id="waiting-column" class="column" data-status-name="調理待ち">
                <h2>🍳 調理待ち</h2>
                <div class="card-container">
                    <div class="card" draggable="true"><div class="card-id">ID: #00126</div><div class="card-custom-status" style="display: none;"></div><div class="card-content">・唐揚げ弁当(大) x 2</div></div>
                    <div class="card" draggable="true"><div class="card-id">ID: #00127</div><div class="card-custom-status" style="display: none;"></div><div class="card-content">・のり弁当 x 1<br>・味噌汁 x 1</div></div>
                </div>
            </div>

            <div id="ready-column" class="column" data-status-name="調理済み">
                <h2>✅ 調理済み</h2>
                <div class="card-container">
                    <div class="card" draggable="true"><div class="card-id">ID: #00121</div><div class="card-custom-status" style="display: none;"></div><div class="card-content">・日替わりランチ x 1</div></div>
                </div>
            </div>

            <div id="delivered-column" class="column" data-status-name="受け渡し済み">
                <h2>📦 受け渡し済み</h2>
                <div class="card-container">
                    </div>
            </div>
            
            <div id="other-column" class="column" data-status-name="その他">
                <h2>📦 その他</h2>
                <div class="card-container">
                     <div class="card" draggable="true"><div class="card-id">ID: #00119</div><div class="card-custom-status">キャンセル</div><div class="card-content">・ミックスフライ弁当 x 1</div></div>
                </div>
            </div>
        </div>

        <div class="history-log">
            <h2>更新履歴</h2>
            <ul id="log-list"></ul>
        </div>
    </div>

    <script>
        const cards = document.querySelectorAll('.card');
        const columns = document.querySelectorAll('.column');
        const logList = document.getElementById('log-list');

        let draggedCard = null;
        let originalColumn = null;

        function addLog(message) {
            const listItem = document.createElement('li');
            const now = new Date();
            const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            listItem.innerHTML = `<span class="log-time">${timeString}</span> ${message}`;
            logList.querySelectorAll('.highlight').forEach(el => el.classList.remove('highlight'));
            logList.prepend(listItem);
            listItem.classList.add('highlight');
        }

        cards.forEach(card => {
            card.addEventListener('dragstart', () => {
                draggedCard = card;
                originalColumn = card.closest('.column');
                setTimeout(() => card.classList.add('dragging'), 0);
            });

            card.addEventListener('dragend', () => {
                if (draggedCard) draggedCard.classList.remove('dragging');
                columns.forEach(col => col.classList.remove('drop-forbidden')); // 全ての列のスタイルをリセット
                draggedCard = null;
                originalColumn = null;
            });
        });

        columns.forEach(column => {
            column.addEventListener('dragover', e => {
                e.preventDefault();
                // 禁止ルールのチェック
                if (originalColumn && originalColumn.id === 'waiting-column' && column.id === 'ready-column') {
                    column.classList.add('drop-forbidden');
                } else {
                    column.classList.remove('drop-forbidden');
                }
            });

            column.addEventListener('dragleave', () => {
                column.classList.remove('drop-forbidden');
            });

            column.addEventListener('drop', e => {
                e.preventDefault();
                column.classList.remove('drop-forbidden');

                if (!draggedCard || !originalColumn || column === originalColumn) return;

                const isForbiddenMove = originalColumn.id === 'waiting-column' && column.id === 'ready-column';
                if (isForbiddenMove) {
                    alert('「調理待ち」から「調理済み」へは直接移動できません。');
                    return; // 処理を中断
                }

                const cardId = draggedCard.querySelector('.card-id').textContent;
                const fromStatus = originalColumn.dataset.statusName;
                let toStatus = column.dataset.statusName;
                let customStatus = "";

                if (column.id === 'other-column') {
                    customStatus = prompt("ステータスを入力してください（例：キャンセル、保留など）", "");
                    if (customStatus === null) return;
                    
                    const statusBadge = draggedCard.querySelector('.card-custom-status');
                    statusBadge.textContent = customStatus;
                    statusBadge.style.display = customStatus ? 'inline-block' : 'none';
                    if(customStatus) toStatus = `その他 (${customStatus})`;
                } else {
                    const statusBadge = draggedCard.querySelector('.card-custom-status');
                    statusBadge.textContent = '';
                    statusBadge.style.display = 'none';
                }

                const cardContainer = column.querySelector('.card-container');
                cardContainer.appendChild(draggedCard);

                const logMessage = `<span class="log-id">${cardId}</span> を <strong>「${fromStatus}」</strong> から <strong>「${toStatus}」</strong> へ移動しました。`;
                addLog(logMessage);
            });
        });

        addLog("システムの利用を開始しました。");
    </script>

</body>
</html>