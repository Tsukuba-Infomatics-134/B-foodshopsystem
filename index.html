<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£Ÿç³§è²©å£² äºˆç´„ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ— Ver.4</title>
    <style>
        /* --- åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« --- */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
            background-color: #f4f5f7; 
            margin: 0; 
            padding: 20px; 
            color: #172b4d; 
            overflow-x: auto; /* ç”»é¢å¹…ãŒè¶³ã‚Šãªã„å ´åˆã«æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’è¨±å¯ */
        }
        h1 { 
            text-align: center; 
            margin-bottom: 20px; 
        }
        
        /* --- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ --- */
        .main-container { 
            display: flex; 
            gap: 20px; 
            align-items: flex-start; 
            justify-content: center; 
            flex-wrap: nowrap; /* å¸¸ã«æ¨ªä¸¦ã³ã‚’ç¶­æŒ */
            min-width: fit-content; /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å¹…ã«åˆã‚ã›ã¦æœ€å°å¹…ã‚’ç¢ºä¿ */
        }
        .board { 
            display: flex; 
            gap: 15px; 
            flex-wrap: nowrap; /* å¸¸ã«æ¨ªä¸¦ã³ã‚’ç¶­æŒ */
            flex-shrink: 0; /* ç¸®å°ã•ã›ãªã„ */
        }

        /* --- å„åˆ—ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼‰ã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
        .column { 
            background-color: #ebecf0; 
            border-radius: 8px; 
            width: 200px; /* å¹…ã‚’å›ºå®š */
            padding: 10px; 
            flex-shrink: 0; 
            transition: background-color 0.2s ease; 
        }
        .column h2 { 
            font-size: 16px; 
            padding: 0 8px; 
            margin: 10px 0; 
        }
        .card-container { 
            min-height: 100px; 
            padding-bottom: 10px; 
        }
        
        /* --- ç¦æ­¢ã•ã‚ŒãŸãƒ‰ãƒ­ãƒƒãƒ—å…ˆã‚’ç¤ºã™ã‚¹ã‚¿ã‚¤ãƒ« --- */
        .column.drop-forbidden {
            background-color: #ffcdd2; /* è–„ã„èµ¤è‰² */
            border: 1px dashed #c62828;
        }

        /* --- äºˆç´„ã‚«ãƒ¼ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
        .card { 
            background-color: #ffffff; 
            border-radius: 5px; 
            padding: 15px; 
            margin-bottom: 10px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); 
            cursor: grab; 
        }
        .card:hover { 
            box-shadow: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23); 
        }
        .card .card-id { 
            font-weight: bold; 
            font-size: 14px; 
            margin-bottom: 5px; 
        }
        .card .card-custom-status { 
            display: none; 
            padding: 2px 8px; 
            font-size: 12px; 
            font-weight: bold; 
            background-color: #6c757d; 
            color: white; 
            border-radius: 10px; 
            margin-bottom: 8px; 
            display: inline-block; 
        }
        .card .card-content { 
            font-size: 14px; 
            line-height: 1.4; 
            margin-top: 5px; 
        }
        .card.dragging { 
            opacity: 0.5; 
            transform: rotate(3deg); 
            cursor: grabbing; 
        }

        /* --- å±¥æ­´ãƒ­ã‚°ã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
        .history-log { 
            width: 350px; /* å¹…ã‚’å›ºå®š */
            background-color: #ffffff; 
            border-radius: 8px; 
            padding: 10px 20px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); 
            flex-shrink: 0; 
        }
        .history-log h2 { 
            font-size: 16px; 
            border-bottom: 1px solid #ebecf0; 
            padding-bottom: 10px; 
        }
        .history-log ul { 
            list-style: none; 
            padding: 0; 
            margin: 0; 
            height: 400px; 
            overflow-y: auto; 
        }
        .history-log li { 
            font-size: 13px; 
            padding: 10px 5px; 
            border-bottom: 1px solid #f4f5f7; 
        }
        .history-log li.highlight { 
            background-color: #e6f7ff; 
        }
        .log-time { 
            color: #5e6c84; 
            display: block; 
            font-size: 12px; 
            margin-bottom: 4px; 
        }
        .log-id { 
            font-weight: bold; 
            color: #0052cc; 
        }
    </style>
</head>
<body>

    <h1>é£Ÿç³§è²©å£² äºˆç´„ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>

    <div class="main-container">
        <div class="board">
            <div id="calling-column" class="column" data-status-name="å‘¼ã³å‡ºã—ä¸­">
                <h2>ğŸ“ å‘¼ã³å‡ºã—ä¸­</h2>
                <div class="card-container">
                    <div class="card" draggable="true"><div class="card-id">ID: #00125</div><div class="card-custom-status" style="display: none;"></div><div class="card-content">ãƒ»ãƒãƒ³ãƒãƒ¼ã‚°å¼å½“ x 1<br>ãƒ»ã‚³ãƒ¼ãƒ«ã‚¹ãƒ­ãƒ¼ x 1</div></div>
                </div>
            </div>

            <div id="waiting-column" class="column" data-status-name="èª¿ç†å¾…ã¡">
                <h2>ğŸ³ èª¿ç†å¾…ã¡</h2>
                <div class="card-container">
                    <div class="card" draggable="true"><div class="card-id">ID: #00126</div><div class="card-custom-status" style="display: none;"></div><div class="card-content">ãƒ»å”æšã’å¼å½“(å¤§) x 2</div></div>
                    <div class="card" draggable="true"><div class="card-id">ID: #00127</div><div class="card-custom-status" style="display: none;"></div><div class="card-content">ãƒ»ã®ã‚Šå¼å½“ x 1<br>ãƒ»å‘³å™Œæ± x 1</div></div>
                </div>
            </div>

            <div id="ready-column" class="column" data-status-name="èª¿ç†æ¸ˆã¿">
                <h2>âœ… èª¿ç†æ¸ˆã¿</h2>
                <div class="card-container">
                    <div class="card" draggable="true"><div class="card-id">ID: #00121</div><div class="card-custom-status" style="display: none;"></div><div class="card-content">ãƒ»æ—¥æ›¿ã‚ã‚Šãƒ©ãƒ³ãƒ x 1</div></div>
                </div>
            </div>

            <div id="delivered-column" class="column" data-status-name="å—ã‘æ¸¡ã—æ¸ˆã¿">
                <h2>ğŸ“¦ å—ã‘æ¸¡ã—æ¸ˆã¿</h2>
                <div class="card-container">
                    </div>
            </div>
            
            <div id="other-column" class="column" data-status-name="ãã®ä»–">
                <h2>ğŸ“¦ ãã®ä»–</h2>
                <div class="card-container">
                     <div class="card" draggable="true"><div class="card-id">ID: #00119</div><div class="card-custom-status">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</div><div class="card-content">ãƒ»ãƒŸãƒƒã‚¯ã‚¹ãƒ•ãƒ©ã‚¤å¼å½“ x 1</div></div>
                </div>
            </div>
        </div>

        <div class="history-log">
            <h2>æ›´æ–°å±¥æ­´</h2>
            <ul id="log-list"></ul>
        </div>
    </div>

    <script>
        const cards = document.querySelectorAll('.card');
        const columns = document.querySelectorAll('.column');
        const logList = document.getElementById('log-list');

        let draggedCard = null;
        let originalColumn = null;

        function addLog(message) {
            const listItem = document.createElement('li');
            const now = new Date();
            const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            listItem.innerHTML = `<span class="log-time">${timeString}</span> ${message}`;
            logList.querySelectorAll('.highlight').forEach(el => el.classList.remove('highlight'));
            logList.prepend(listItem);
            listItem.classList.add('highlight');
        }

        cards.forEach(card => {
            card.addEventListener('dragstart', () => {
                draggedCard = card;
                originalColumn = card.closest('.column');
                setTimeout(() => card.classList.add('dragging'), 0);
            });

            card.addEventListener('dragend', () => {
                if (draggedCard) draggedCard.classList.remove('dragging');
                columns.forEach(col => col.classList.remove('drop-forbidden')); // å…¨ã¦ã®åˆ—ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
                draggedCard = null;
                originalColumn = null;
            });
        });

        columns.forEach(column => {
            column.addEventListener('dragover', e => {
                e.preventDefault();
                // ç¦æ­¢ãƒ«ãƒ¼ãƒ«ã®ãƒã‚§ãƒƒã‚¯
                if (originalColumn && originalColumn.id === 'waiting-column' && column.id === 'ready-column') {
                    column.classList.add('drop-forbidden');
                } else {
                    column.classList.remove('drop-forbidden');
                }
            });

            column.addEventListener('dragleave', () => {
                column.classList.remove('drop-forbidden');
            });

            column.addEventListener('drop', e => {
                e.preventDefault();
                column.classList.remove('drop-forbidden');

                if (!draggedCard || !originalColumn || column === originalColumn) return;

                const isForbiddenMove = originalColumn.id === 'waiting-column' && column.id === 'ready-column';
                if (isForbiddenMove) {
                    alert('ã€Œèª¿ç†å¾…ã¡ã€ã‹ã‚‰ã€Œèª¿ç†æ¸ˆã¿ã€ã¸ã¯ç›´æ¥ç§»å‹•ã§ãã¾ã›ã‚“ã€‚');
                    return; // å‡¦ç†ã‚’ä¸­æ–­
                }

                const cardId = draggedCard.querySelector('.card-id').textContent;
                const fromStatus = originalColumn.dataset.statusName;
                let toStatus = column.dataset.statusName;
                let customStatus = "";

                if (column.id === 'other-column') {
                    customStatus = prompt("ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€ä¿ç•™ãªã©ï¼‰", "");
                    if (customStatus === null) return;
                    
                    const statusBadge = draggedCard.querySelector('.card-custom-status');
                    statusBadge.textContent = customStatus;
                    statusBadge.style.display = customStatus ? 'inline-block' : 'none';
                    if(customStatus) toStatus = `ãã®ä»– (${customStatus})`;
                } else {
                    const statusBadge = draggedCard.querySelector('.card-custom-status');
                    statusBadge.textContent = '';
                    statusBadge.style.display = 'none';
                }

                const cardContainer = column.querySelector('.card-container');
                cardContainer.appendChild(draggedCard);

                const logMessage = `<span class="log-id">${cardId}</span> ã‚’ <strong>ã€Œ${fromStatus}ã€</strong> ã‹ã‚‰ <strong>ã€Œ${toStatus}ã€</strong> ã¸ç§»å‹•ã—ã¾ã—ãŸã€‚`;
                addLog(logMessage);
            });
        });

        addLog("ã‚·ã‚¹ãƒ†ãƒ ã®åˆ©ç”¨ã‚’é–‹å§‹ã—ã¾ã—ãŸã€‚");
    </script>

</body>
</html>